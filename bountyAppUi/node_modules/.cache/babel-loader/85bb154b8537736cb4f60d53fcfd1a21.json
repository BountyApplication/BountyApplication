{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { BaseLoggger, Html5QrcodeResultFactory, Html5QrcodeErrorFactory, Html5QrcodeSupportedFormats, isValidHtml5QrcodeSupportedFormats, Html5QrcodeConstants, isNullOrUndefined } from \"./core\";\nimport { Html5QrcodeStrings } from \"./strings\";\nimport { VideoConstraintsUtil } from \"./utils\";\nimport { Html5QrcodeShim } from \"./code-decoder\";\nimport { ExperimentalFeaturesConfigFactory } from \"./experimental-features\";\nimport { StateManagerFactory, Html5QrcodeScannerState } from \"./state-manager\";\n\nvar Constants = function (_super) {\n  __extends(Constants, _super);\n\n  function Constants() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Constants.DEFAULT_WIDTH = 300;\n  Constants.DEFAULT_WIDTH_OFFSET = 2;\n  Constants.FILE_SCAN_MIN_HEIGHT = 300;\n  Constants.MIN_QR_BOX_SIZE = 50;\n  Constants.SHADED_LEFT = 1;\n  Constants.SHADED_RIGHT = 2;\n  Constants.SHADED_TOP = 3;\n  Constants.SHADED_BOTTOM = 4;\n  Constants.SHADED_REGION_ELEMENT_ID = \"qr-shaded-region\";\n  Constants.VERBOSE = false;\n  Constants.BORDER_SHADER_DEFAULT_COLOR = \"#ffffff\";\n  Constants.BORDER_SHADER_MATCH_COLOR = \"rgb(90, 193, 56)\";\n  return Constants;\n}(Html5QrcodeConstants);\n\nvar InternalHtml5QrcodeConfig = function () {\n  function InternalHtml5QrcodeConfig(config, logger) {\n    this.logger = logger;\n    this.fps = Constants.SCAN_DEFAULT_FPS;\n\n    if (!config) {\n      this.disableFlip = Constants.DEFAULT_DISABLE_FLIP;\n    } else {\n      if (config.fps) {\n        this.fps = config.fps;\n      }\n\n      this.disableFlip = config.disableFlip === true;\n      this.qrbox = config.qrbox;\n      this.aspectRatio = config.aspectRatio;\n      this.videoConstraints = config.videoConstraints;\n    }\n  }\n\n  InternalHtml5QrcodeConfig.prototype.isMediaStreamConstraintsValid = function () {\n    if (!this.videoConstraints) {\n      this.logger.logError(\"Empty videoConstraints\", true);\n      return false;\n    }\n\n    return VideoConstraintsUtil.isMediaStreamConstraintsValid(this.videoConstraints, this.logger);\n  };\n\n  InternalHtml5QrcodeConfig.prototype.isShadedBoxEnabled = function () {\n    return !isNullOrUndefined(this.qrbox);\n  };\n\n  InternalHtml5QrcodeConfig.create = function (config, logger) {\n    return new InternalHtml5QrcodeConfig(config, logger);\n  };\n\n  return InternalHtml5QrcodeConfig;\n}();\n\nvar Html5Qrcode = function () {\n  function Html5Qrcode(elementId, configOrVerbosityFlag) {\n    this.element = null;\n    this.canvasElement = null;\n    this.scannerPausedUiElement = null;\n    this.hasBorderShaders = null;\n    this.borderShaders = null;\n    this.qrMatch = null;\n    this.videoElement = null;\n    this.localMediaStream = null;\n    this.qrRegion = null;\n    this.context = null;\n    this.lastScanImageFile = null;\n    this.isScanning = false;\n\n    if (!document.getElementById(elementId)) {\n      throw \"HTML Element with id=\" + elementId + \" not found\";\n    }\n\n    this.elementId = elementId;\n    this.verbose = false;\n    var experimentalFeatureConfig;\n\n    if (typeof configOrVerbosityFlag == \"boolean\") {\n      this.verbose = configOrVerbosityFlag === true;\n    } else if (configOrVerbosityFlag) {\n      this.verbose = configOrVerbosityFlag.verbose === true;\n      experimentalFeatureConfig = configOrVerbosityFlag.experimentalFeatures;\n    }\n\n    this.logger = new BaseLoggger(this.verbose);\n    this.qrcode = new Html5QrcodeShim(this.getSupportedFormats(configOrVerbosityFlag), this.verbose, this.logger, ExperimentalFeaturesConfigFactory.createExperimentalFeaturesConfig(experimentalFeatureConfig));\n    this.foreverScanTimeout;\n    this.localMediaStream;\n    this.shouldScan = true;\n    this.stateManagerProxy = StateManagerFactory.create();\n  }\n\n  Html5Qrcode.prototype.start = function (cameraIdOrConfig, configuration, qrCodeSuccessCallback, qrCodeErrorCallback) {\n    if (!cameraIdOrConfig) {\n      throw \"cameraIdOrConfig is required\";\n    }\n\n    if (!qrCodeSuccessCallback || typeof qrCodeSuccessCallback != \"function\") {\n      throw \"qrCodeSuccessCallback is required and should be a function.\";\n    }\n\n    if (!qrCodeErrorCallback) {\n      qrCodeErrorCallback = this.verbose ? this.logger.log : function () {};\n    }\n\n    var internalConfig = InternalHtml5QrcodeConfig.create(configuration, this.logger);\n    this.clearElement();\n    var videoConstraintsAvailableAndValid = false;\n\n    if (internalConfig.videoConstraints) {\n      if (!internalConfig.isMediaStreamConstraintsValid()) {\n        this.logger.logError(\"'videoConstraints' is not valid 'MediaStreamConstraints, \" + \"it will be ignored.'\", true);\n      } else {\n        videoConstraintsAvailableAndValid = true;\n      }\n    }\n\n    var areVideoConstraintsEnabled = videoConstraintsAvailableAndValid;\n    var isShadedBoxEnabled = internalConfig.isShadedBoxEnabled();\n    var element = document.getElementById(this.elementId);\n    var rootElementWidth = element.clientWidth ? element.clientWidth : Constants.DEFAULT_WIDTH;\n    element.style.position = \"relative\";\n    this.shouldScan = true;\n    this.element = element;\n    var $this = this;\n    var toScanningStateChangeTransaction = this.stateManagerProxy.startTransition(Html5QrcodeScannerState.SCANNING);\n    return new Promise(function (resolve, reject) {\n      var videoConstraints = areVideoConstraintsEnabled ? internalConfig.videoConstraints : $this.createVideoConstraints(cameraIdOrConfig);\n\n      if (!videoConstraints) {\n        toScanningStateChangeTransaction.cancel();\n        reject(\"videoConstraints should be defined\");\n        return;\n      }\n\n      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n        navigator.mediaDevices.getUserMedia({\n          audio: false,\n          video: videoConstraints\n        }).then(function (stream) {\n          $this.onMediaStreamReceived(stream, internalConfig, areVideoConstraintsEnabled, rootElementWidth, qrCodeSuccessCallback, qrCodeErrorCallback).then(function (_) {\n            toScanningStateChangeTransaction.execute();\n            $this.isScanning = true;\n            resolve(null);\n          }).catch(function (error) {\n            toScanningStateChangeTransaction.cancel();\n            reject(error);\n          });\n        }).catch(function (error) {\n          toScanningStateChangeTransaction.cancel();\n          reject(Html5QrcodeStrings.errorGettingUserMedia(error));\n        });\n      } else {\n        toScanningStateChangeTransaction.cancel();\n        reject(Html5QrcodeStrings.cameraStreamingNotSupported());\n      }\n    });\n  };\n\n  Html5Qrcode.prototype.pause = function (shouldPauseVideo) {\n    if (!this.stateManagerProxy.isStrictlyScanning()) {\n      throw \"Cannot pause, scanner is not scanning.\";\n    }\n\n    this.stateManagerProxy.directTransition(Html5QrcodeScannerState.PAUSED);\n    this.showPausedState();\n\n    if (isNullOrUndefined(shouldPauseVideo) || shouldPauseVideo !== true) {\n      shouldPauseVideo = false;\n    }\n\n    if (shouldPauseVideo && this.videoElement) {\n      this.videoElement.pause();\n    }\n  };\n\n  Html5Qrcode.prototype.resume = function () {\n    if (!this.stateManagerProxy.isPaused()) {\n      throw \"Cannot result, scanner is not paused.\";\n    }\n\n    if (!this.videoElement) {\n      throw \"VideoElement doesn't exist while trying resume()\";\n    }\n\n    var $this = this;\n\n    var transitionToScanning = function () {\n      $this.stateManagerProxy.directTransition(Html5QrcodeScannerState.SCANNING);\n      $this.hidePausedState();\n    };\n\n    var isVideoPaused = this.videoElement.paused;\n\n    if (!isVideoPaused) {\n      transitionToScanning();\n      return;\n    }\n\n    var onVideoResume = function () {\n      var _a;\n\n      setTimeout(transitionToScanning, 200);\n      (_a = $this.videoElement) === null || _a === void 0 ? void 0 : _a.removeEventListener(\"playing\", onVideoResume);\n    };\n\n    this.videoElement.addEventListener(\"playing\", onVideoResume);\n    this.videoElement.play();\n  };\n\n  Html5Qrcode.prototype.getState = function () {\n    return this.stateManagerProxy.getState();\n  };\n\n  Html5Qrcode.prototype.stop = function () {\n    var _this = this;\n\n    if (!this.stateManagerProxy.isScanning()) {\n      throw \"Cannot stop, scanner is not running or paused.\";\n    }\n\n    var toStoppedStateTransaction = this.stateManagerProxy.startTransition(Html5QrcodeScannerState.NOT_STARTED);\n    this.shouldScan = false;\n\n    if (this.foreverScanTimeout) {\n      clearTimeout(this.foreverScanTimeout);\n    }\n\n    var removeQrRegion = function () {\n      if (!_this.element) {\n        return;\n      }\n\n      var childElement = document.getElementById(Constants.SHADED_REGION_ELEMENT_ID);\n\n      if (childElement) {\n        _this.element.removeChild(childElement);\n      }\n    };\n\n    return new Promise(function (resolve, _) {\n      var onAllTracksClosed = function () {\n        _this.localMediaStream = null;\n\n        if (_this.element) {\n          _this.element.removeChild(_this.videoElement);\n\n          _this.element.removeChild(_this.canvasElement);\n        }\n\n        removeQrRegion();\n\n        if (_this.qrRegion) {\n          _this.qrRegion = null;\n        }\n\n        if (_this.context) {\n          _this.context = null;\n        }\n\n        toStoppedStateTransaction.execute();\n\n        _this.hidePausedState();\n\n        _this.isScanning = false;\n        resolve();\n      };\n\n      if (!_this.localMediaStream) {\n        onAllTracksClosed();\n      }\n\n      var tracksToClose = _this.localMediaStream.getVideoTracks().length;\n\n      var tracksClosed = 0;\n\n      _this.localMediaStream.getVideoTracks().forEach(function (videoTrack) {\n        _this.localMediaStream.removeTrack(videoTrack);\n\n        videoTrack.stop();\n        ++tracksClosed;\n\n        if (tracksClosed >= tracksToClose) {\n          onAllTracksClosed();\n        }\n      });\n    });\n  };\n\n  Html5Qrcode.prototype.scanFile = function (imageFile, showImage) {\n    return this.scanFileV2(imageFile, showImage).then(function (html5qrcodeResult) {\n      return html5qrcodeResult.decodedText;\n    });\n  };\n\n  Html5Qrcode.prototype.scanFileV2 = function (imageFile, showImage) {\n    var _this = this;\n\n    if (!imageFile || !(imageFile instanceof File)) {\n      throw \"imageFile argument is mandatory and should be instance \" + \"of File. Use 'event.target.files[0]'.\";\n    }\n\n    if (isNullOrUndefined(showImage)) {\n      showImage = true;\n    }\n\n    if (!this.stateManagerProxy.canScanFile()) {\n      throw \"Cannot start file scan - ongoing camera scan\";\n    }\n\n    return new Promise(function (resolve, reject) {\n      _this.possiblyCloseLastScanImageFile();\n\n      _this.clearElement();\n\n      _this.lastScanImageFile = URL.createObjectURL(imageFile);\n      var inputImage = new Image();\n\n      inputImage.onload = function () {\n        var imageWidth = inputImage.width;\n        var imageHeight = inputImage.height;\n        var element = document.getElementById(_this.elementId);\n        var containerWidth = element.clientWidth ? element.clientWidth : Constants.DEFAULT_WIDTH;\n        var containerHeight = Math.max(element.clientHeight ? element.clientHeight : imageHeight, Constants.FILE_SCAN_MIN_HEIGHT);\n\n        var config = _this.computeCanvasDrawConfig(imageWidth, imageHeight, containerWidth, containerHeight);\n\n        if (showImage) {\n          var visibleCanvas = _this.createCanvasElement(containerWidth, containerHeight, \"qr-canvas-visible\");\n\n          visibleCanvas.style.display = \"inline-block\";\n          element.appendChild(visibleCanvas);\n          var context_1 = visibleCanvas.getContext(\"2d\");\n\n          if (!context_1) {\n            throw \"Unable to get 2d context from canvas\";\n          }\n\n          context_1.canvas.width = containerWidth;\n          context_1.canvas.height = containerHeight;\n          context_1.drawImage(inputImage, 0, 0, imageWidth, imageHeight, config.x, config.y, config.width, config.height);\n        }\n\n        var hiddenCanvas = _this.createCanvasElement(config.width, config.height);\n\n        element.appendChild(hiddenCanvas);\n        var context = hiddenCanvas.getContext(\"2d\");\n\n        if (!context) {\n          throw \"Unable to get 2d context from canvas\";\n        }\n\n        context.canvas.width = config.width;\n        context.canvas.height = config.height;\n        context.drawImage(inputImage, 0, 0, imageWidth, imageHeight, 0, 0, config.width, config.height);\n\n        try {\n          _this.qrcode.decodeAsync(hiddenCanvas).then(function (result) {\n            resolve(Html5QrcodeResultFactory.createFromQrcodeResult(result));\n          }).catch(reject);\n        } catch (exception) {\n          reject(\"QR code parse error, error = \" + exception);\n        }\n      };\n\n      inputImage.onerror = reject;\n      inputImage.onabort = reject;\n      inputImage.onstalled = reject;\n      inputImage.onsuspend = reject;\n      inputImage.src = URL.createObjectURL(imageFile);\n    });\n  };\n\n  Html5Qrcode.prototype.clear = function () {\n    this.clearElement();\n  };\n\n  Html5Qrcode.getCameras = function () {\n    if (navigator.mediaDevices) {\n      return Html5Qrcode.getCamerasFromMediaDevices();\n    }\n\n    var mst = MediaStreamTrack;\n\n    if (MediaStreamTrack && mst.getSources) {\n      return Html5Qrcode.getCamerasFromMediaStreamTrack();\n    }\n\n    var isHttpsOrLocalhost = function () {\n      if (location.protocol === \"https:\") {\n        return true;\n      }\n\n      var host = location.host.split(\":\")[0];\n      return host === \"127.0.0.1\" || host === \"localhost\";\n    };\n\n    var errorMessage = Html5QrcodeStrings.unableToQuerySupportedDevices();\n\n    if (!isHttpsOrLocalhost()) {\n      errorMessage = Html5QrcodeStrings.insecureContextCameraQueryError();\n    }\n\n    return Promise.reject(errorMessage);\n  };\n\n  Html5Qrcode.prototype.getRunningTrackCapabilities = function () {\n    if (this.localMediaStream == null) {\n      throw \"Scanning is not in running state, call this API only when\" + \" QR code scanning using camera is in running state.\";\n    }\n\n    if (this.localMediaStream.getVideoTracks().length === 0) {\n      throw \"No video tracks found\";\n    }\n\n    var videoTrack = this.localMediaStream.getVideoTracks()[0];\n    return videoTrack.getCapabilities();\n  };\n\n  Html5Qrcode.prototype.applyVideoConstraints = function (videoConstaints) {\n    var _this = this;\n\n    if (!videoConstaints) {\n      throw \"videoConstaints is required argument.\";\n    } else if (!VideoConstraintsUtil.isMediaStreamConstraintsValid(videoConstaints, this.logger)) {\n      throw \"invalid videoConstaints passed, check logs for more details\";\n    }\n\n    if (this.localMediaStream === null) {\n      throw \"Scanning is not in running state, call this API only when\" + \" QR code scanning using camera is in running state.\";\n    }\n\n    if (this.localMediaStream.getVideoTracks().length === 0) {\n      throw \"No video tracks found\";\n    }\n\n    return new Promise(function (resolve, reject) {\n      if (\"aspectRatio\" in videoConstaints) {\n        reject(\"Chaning 'aspectRatio' in run-time is not yet \" + \"supported.\");\n        return;\n      }\n\n      var videoTrack = _this.localMediaStream.getVideoTracks()[0];\n\n      videoTrack.applyConstraints(videoConstaints).then(function (_) {\n        resolve(_);\n      }).catch(function (error) {\n        reject(error);\n      });\n    });\n  };\n\n  Html5Qrcode.getCamerasFromMediaDevices = function () {\n    return new Promise(function (resolve, reject) {\n      navigator.mediaDevices.getUserMedia({\n        audio: false,\n        video: true\n      }).then(function (stream) {\n        var closeActiveStreams = function (stream) {\n          var tracks = stream.getVideoTracks();\n\n          for (var _i = 0, tracks_1 = tracks; _i < tracks_1.length; _i++) {\n            var track = tracks_1[_i];\n            track.enabled = false;\n            track.stop();\n            stream.removeTrack(track);\n          }\n        };\n\n        navigator.mediaDevices.enumerateDevices().then(function (devices) {\n          var results = [];\n\n          for (var _i = 0, devices_1 = devices; _i < devices_1.length; _i++) {\n            var device = devices_1[_i];\n\n            if (device.kind === \"videoinput\") {\n              results.push({\n                id: device.deviceId,\n                label: device.label\n              });\n            }\n          }\n\n          closeActiveStreams(stream);\n          resolve(results);\n        }).catch(function (err) {\n          reject(err.name + \" : \" + err.message);\n        });\n      }).catch(function (err) {\n        reject(err.name + \" : \" + err.message);\n      });\n    });\n  };\n\n  Html5Qrcode.getCamerasFromMediaStreamTrack = function () {\n    return new Promise(function (resolve, _) {\n      var callback = function (sourceInfos) {\n        var results = [];\n\n        for (var _i = 0, sourceInfos_1 = sourceInfos; _i < sourceInfos_1.length; _i++) {\n          var sourceInfo = sourceInfos_1[_i];\n\n          if (sourceInfo.kind === \"video\") {\n            results.push({\n              id: sourceInfo.id,\n              label: sourceInfo.label\n            });\n          }\n        }\n\n        resolve(results);\n      };\n\n      var mst = MediaStreamTrack;\n      mst.getSources(callback);\n    });\n  };\n\n  Html5Qrcode.prototype.getSupportedFormats = function (configOrVerbosityFlag) {\n    var allFormats = [Html5QrcodeSupportedFormats.QR_CODE, Html5QrcodeSupportedFormats.AZTEC, Html5QrcodeSupportedFormats.CODABAR, Html5QrcodeSupportedFormats.CODE_39, Html5QrcodeSupportedFormats.CODE_93, Html5QrcodeSupportedFormats.CODE_128, Html5QrcodeSupportedFormats.DATA_MATRIX, Html5QrcodeSupportedFormats.MAXICODE, Html5QrcodeSupportedFormats.ITF, Html5QrcodeSupportedFormats.EAN_13, Html5QrcodeSupportedFormats.EAN_8, Html5QrcodeSupportedFormats.PDF_417, Html5QrcodeSupportedFormats.RSS_14, Html5QrcodeSupportedFormats.RSS_EXPANDED, Html5QrcodeSupportedFormats.UPC_A, Html5QrcodeSupportedFormats.UPC_E, Html5QrcodeSupportedFormats.UPC_EAN_EXTENSION];\n\n    if (!configOrVerbosityFlag || typeof configOrVerbosityFlag == \"boolean\") {\n      return allFormats;\n    }\n\n    if (!configOrVerbosityFlag.formatsToSupport) {\n      return allFormats;\n    }\n\n    if (!Array.isArray(configOrVerbosityFlag.formatsToSupport)) {\n      throw \"configOrVerbosityFlag.formatsToSupport should be undefined \" + \"or an array.\";\n    }\n\n    if (configOrVerbosityFlag.formatsToSupport.length === 0) {\n      throw \"Atleast 1 formatsToSupport is needed.\";\n    }\n\n    var supportedFormats = [];\n\n    for (var _i = 0, _a = configOrVerbosityFlag.formatsToSupport; _i < _a.length; _i++) {\n      var format = _a[_i];\n\n      if (isValidHtml5QrcodeSupportedFormats(format)) {\n        supportedFormats.push(format);\n      } else {\n        this.logger.warn(\"Invalid format: \" + format + \" passed in config, ignoring.\");\n      }\n    }\n\n    if (supportedFormats.length === 0) {\n      throw \"None of formatsToSupport match supported values.\";\n    }\n\n    return supportedFormats;\n  };\n\n  Html5Qrcode.prototype.validateQrboxSize = function (viewfinderWidth, viewfinderHeight, internalConfig) {\n    var _this = this;\n\n    var qrboxSize = internalConfig.qrbox;\n    this.validateQrboxConfig(qrboxSize);\n    var qrDimensions = this.toQrdimensions(viewfinderWidth, viewfinderHeight, qrboxSize);\n\n    var validateMinSize = function (size) {\n      if (size < Constants.MIN_QR_BOX_SIZE) {\n        throw \"minimum size of 'config.qrbox' dimension value is\" + (\" \" + Constants.MIN_QR_BOX_SIZE + \"px.\");\n      }\n    };\n\n    var correctWidthBasedOnRootElementSize = function (configWidth) {\n      if (configWidth > viewfinderWidth) {\n        _this.logger.warn(\"`qrbox.width` or `qrbox` is larger than the\" + \" width of the root element. The width will be truncated\" + \" to the width of root element.\");\n\n        configWidth = viewfinderWidth;\n      }\n\n      return configWidth;\n    };\n\n    validateMinSize(qrDimensions.width);\n    validateMinSize(qrDimensions.height);\n    qrDimensions.width = correctWidthBasedOnRootElementSize(qrDimensions.width);\n  };\n\n  Html5Qrcode.prototype.validateQrboxConfig = function (qrboxSize) {\n    if (typeof qrboxSize === \"number\") {\n      return;\n    }\n\n    if (typeof qrboxSize === \"function\") {\n      return;\n    }\n\n    if (qrboxSize.width === undefined || qrboxSize.height === undefined) {\n      throw \"Invalid instance of QrDimensions passed for \" + \"'config.qrbox'. Both 'width' and 'height' should be set.\";\n    }\n  };\n\n  Html5Qrcode.prototype.toQrdimensions = function (viewfinderWidth, viewfinderHeight, qrboxSize) {\n    if (typeof qrboxSize === \"number\") {\n      return {\n        width: qrboxSize,\n        height: qrboxSize\n      };\n    } else if (typeof qrboxSize === \"function\") {\n      try {\n        return qrboxSize(viewfinderWidth, viewfinderHeight);\n      } catch (error) {\n        throw new Error(\"qrbox config was passed as a function but it failed with \" + \"unknown error\" + error);\n      }\n    }\n\n    return qrboxSize;\n  };\n\n  Html5Qrcode.prototype.setupUi = function (viewfinderWidth, viewfinderHeight, internalConfig) {\n    if (internalConfig.isShadedBoxEnabled()) {\n      this.validateQrboxSize(viewfinderWidth, viewfinderHeight, internalConfig);\n    }\n\n    var qrboxSize = isNullOrUndefined(internalConfig.qrbox) ? {\n      width: viewfinderWidth,\n      height: viewfinderHeight\n    } : internalConfig.qrbox;\n    this.validateQrboxConfig(qrboxSize);\n    var qrDimensions = this.toQrdimensions(viewfinderWidth, viewfinderHeight, qrboxSize);\n\n    if (qrDimensions.height > viewfinderHeight) {\n      this.logger.warn(\"[Html5Qrcode] config.qrbox has height that is\" + \"greater than the height of the video stream. Shading will be\" + \" ignored\");\n    }\n\n    var shouldShadingBeApplied = internalConfig.isShadedBoxEnabled() && qrDimensions.height <= viewfinderHeight;\n    var defaultQrRegion = {\n      x: 0,\n      y: 0,\n      width: viewfinderWidth,\n      height: viewfinderHeight\n    };\n    var qrRegion = shouldShadingBeApplied ? this.getShadedRegionBounds(viewfinderWidth, viewfinderHeight, qrDimensions) : defaultQrRegion;\n    var canvasElement = this.createCanvasElement(qrRegion.width, qrRegion.height);\n    var context = canvasElement.getContext(\"2d\");\n    context.canvas.width = qrRegion.width;\n    context.canvas.height = qrRegion.height;\n    this.element.append(canvasElement);\n\n    if (shouldShadingBeApplied) {\n      this.possiblyInsertShadingElement(this.element, viewfinderWidth, viewfinderHeight, qrDimensions);\n    }\n\n    this.createScannerPausedUiElement(this.element);\n    this.qrRegion = qrRegion;\n    this.context = context;\n    this.canvasElement = canvasElement;\n  };\n\n  Html5Qrcode.prototype.createScannerPausedUiElement = function (rootElement) {\n    var scannerPausedUiElement = document.createElement(\"div\");\n    scannerPausedUiElement.innerText = \"Scanner paused\";\n    scannerPausedUiElement.style.display = \"none\";\n    scannerPausedUiElement.style.position = \"absolute\";\n    scannerPausedUiElement.style.top = \"0px\";\n    scannerPausedUiElement.style.zIndex = \"1\";\n    scannerPausedUiElement.style.background = \"yellow\";\n    scannerPausedUiElement.style.textAlign = \"center\";\n    scannerPausedUiElement.style.width = \"100%\";\n    rootElement.appendChild(scannerPausedUiElement);\n    this.scannerPausedUiElement = scannerPausedUiElement;\n  };\n\n  Html5Qrcode.prototype.scanContext = function (qrCodeSuccessCallback, qrCodeErrorCallback) {\n    var _this = this;\n\n    if (this.stateManagerProxy.isPaused()) {\n      return Promise.resolve(false);\n    }\n\n    return this.qrcode.decodeAsync(this.canvasElement).then(function (result) {\n      qrCodeSuccessCallback(result.text, Html5QrcodeResultFactory.createFromQrcodeResult(result));\n\n      _this.possiblyUpdateShaders(true);\n\n      return true;\n    }).catch(function (error) {\n      _this.possiblyUpdateShaders(false);\n\n      var errorMessage = Html5QrcodeStrings.codeParseError(error);\n      qrCodeErrorCallback(errorMessage, Html5QrcodeErrorFactory.createFrom(errorMessage));\n      return false;\n    });\n  };\n\n  Html5Qrcode.prototype.foreverScan = function (internalConfig, qrCodeSuccessCallback, qrCodeErrorCallback) {\n    var _this = this;\n\n    if (!this.shouldScan) {\n      return;\n    }\n\n    if (!this.localMediaStream) {\n      return;\n    }\n\n    var videoElement = this.videoElement;\n    var widthRatio = videoElement.videoWidth / videoElement.clientWidth;\n    var heightRatio = videoElement.videoHeight / videoElement.clientHeight;\n\n    if (!this.qrRegion) {\n      throw \"qrRegion undefined when localMediaStream is ready.\";\n    }\n\n    var sWidthOffset = this.qrRegion.width * widthRatio;\n    var sHeightOffset = this.qrRegion.height * heightRatio;\n    var sxOffset = this.qrRegion.x * widthRatio;\n    var syOffset = this.qrRegion.y * heightRatio;\n    this.context.drawImage(videoElement, sxOffset, syOffset, sWidthOffset, sHeightOffset, 0, 0, this.qrRegion.width, this.qrRegion.height);\n\n    var triggerNextScan = function () {\n      _this.foreverScanTimeout = setTimeout(function () {\n        _this.foreverScan(internalConfig, qrCodeSuccessCallback, qrCodeErrorCallback);\n      }, _this.getTimeoutFps(internalConfig.fps));\n    };\n\n    this.scanContext(qrCodeSuccessCallback, qrCodeErrorCallback).then(function (isSuccessfull) {\n      if (!isSuccessfull && internalConfig.disableFlip !== true) {\n        _this.context.translate(_this.context.canvas.width, 0);\n\n        _this.context.scale(-1, 1);\n\n        _this.scanContext(qrCodeSuccessCallback, qrCodeErrorCallback).finally(function () {\n          triggerNextScan();\n        });\n      } else {\n        triggerNextScan();\n      }\n    }).catch(function (error) {\n      _this.logger.logError(\"Error happend while scanning context\", error);\n\n      triggerNextScan();\n    });\n  };\n\n  Html5Qrcode.prototype.onMediaStreamReceived = function (mediaStream, internalConfig, areVideoConstraintsEnabled, clientWidth, qrCodeSuccessCallback, qrCodeErrorCallback) {\n    var _this = this;\n\n    var $this = this;\n    return new Promise(function (resolve, reject) {\n      var setupVideo = function () {\n        var videoElement = _this.createVideoElement(clientWidth);\n\n        $this.element.append(videoElement);\n        videoElement.onabort = reject;\n        videoElement.onerror = reject;\n\n        var onVideoStart = function () {\n          var videoWidth = videoElement.clientWidth;\n          var videoHeight = videoElement.clientHeight;\n          $this.setupUi(videoWidth, videoHeight, internalConfig);\n          $this.foreverScan(internalConfig, qrCodeSuccessCallback, qrCodeErrorCallback);\n          videoElement.removeEventListener(\"playing\", onVideoStart);\n          resolve(null);\n        };\n\n        videoElement.addEventListener(\"playing\", onVideoStart);\n        videoElement.srcObject = mediaStream;\n        videoElement.play();\n        $this.videoElement = videoElement;\n      };\n\n      $this.localMediaStream = mediaStream;\n\n      if (areVideoConstraintsEnabled || !internalConfig.aspectRatio) {\n        setupVideo();\n      } else {\n        var constraints = {\n          aspectRatio: internalConfig.aspectRatio\n        };\n        var track = mediaStream.getVideoTracks()[0];\n        track.applyConstraints(constraints).then(function (_) {\n          return setupVideo();\n        }).catch(function (error) {\n          $this.logger.logErrors([\"[Html5Qrcode] Constriants could not \" + \"be satisfied, ignoring constraints\", error]);\n          setupVideo();\n        });\n      }\n    });\n  };\n\n  Html5Qrcode.prototype.createVideoConstraints = function (cameraIdOrConfig) {\n    if (typeof cameraIdOrConfig == \"string\") {\n      return {\n        deviceId: {\n          exact: cameraIdOrConfig\n        }\n      };\n    } else if (typeof cameraIdOrConfig == \"object\") {\n      var facingModeKey = \"facingMode\";\n      var deviceIdKey = \"deviceId\";\n      var allowedFacingModeValues_1 = {\n        \"user\": true,\n        \"environment\": true\n      };\n      var exactKey = \"exact\";\n\n      var isValidFacingModeValue = function (value) {\n        if (value in allowedFacingModeValues_1) {\n          return true;\n        } else {\n          throw \"config has invalid 'facingMode' value = \" + (\"'\" + value + \"'\");\n        }\n      };\n\n      var keys = Object.keys(cameraIdOrConfig);\n\n      if (keys.length !== 1) {\n        throw \"'cameraIdOrConfig' object should have exactly 1 key,\" + (\" if passed as an object, found \" + keys.length + \" keys\");\n      }\n\n      var key = Object.keys(cameraIdOrConfig)[0];\n\n      if (key !== facingModeKey && key !== deviceIdKey) {\n        throw \"Only '\" + facingModeKey + \"' and '\" + deviceIdKey + \"' \" + \" are supported for 'cameraIdOrConfig'\";\n      }\n\n      if (key === facingModeKey) {\n        var facingMode = cameraIdOrConfig.facingMode;\n\n        if (typeof facingMode == \"string\") {\n          if (isValidFacingModeValue(facingMode)) {\n            return {\n              facingMode: facingMode\n            };\n          }\n        } else if (typeof facingMode == \"object\") {\n          if (exactKey in facingMode) {\n            if (isValidFacingModeValue(facingMode[\"\" + exactKey])) {\n              return {\n                facingMode: {\n                  exact: facingMode[\"\" + exactKey]\n                }\n              };\n            }\n          } else {\n            throw \"'facingMode' should be string or object with\" + (\" \" + exactKey + \" as key.\");\n          }\n        } else {\n          var type_1 = typeof facingMode;\n          throw \"Invalid type of 'facingMode' = \" + type_1;\n        }\n      } else {\n        var deviceId = cameraIdOrConfig.deviceId;\n\n        if (typeof deviceId == \"string\") {\n          return {\n            deviceId: deviceId\n          };\n        } else if (typeof deviceId == \"object\") {\n          if (exactKey in deviceId) {\n            return {\n              deviceId: {\n                exact: deviceId[\"\" + exactKey]\n              }\n            };\n          } else {\n            throw \"'deviceId' should be string or object with\" + (\" \" + exactKey + \" as key.\");\n          }\n        } else {\n          var type_2 = typeof deviceId;\n          throw \"Invalid type of 'deviceId' = \" + type_2;\n        }\n      }\n    }\n\n    var type = typeof cameraIdOrConfig;\n    throw \"Invalid type of 'cameraIdOrConfig' = \" + type;\n  };\n\n  Html5Qrcode.prototype.computeCanvasDrawConfig = function (imageWidth, imageHeight, containerWidth, containerHeight) {\n    if (imageWidth <= containerWidth && imageHeight <= containerHeight) {\n      var xoffset = (containerWidth - imageWidth) / 2;\n      var yoffset = (containerHeight - imageHeight) / 2;\n      return {\n        x: xoffset,\n        y: yoffset,\n        width: imageWidth,\n        height: imageHeight\n      };\n    } else {\n      var formerImageWidth = imageWidth;\n      var formerImageHeight = imageHeight;\n\n      if (imageWidth > containerWidth) {\n        imageHeight = containerWidth / imageWidth * imageHeight;\n        imageWidth = containerWidth;\n      }\n\n      if (imageHeight > containerHeight) {\n        imageWidth = containerHeight / imageHeight * imageWidth;\n        imageHeight = containerHeight;\n      }\n\n      this.logger.log(\"Image downsampled from \" + (formerImageWidth + \"X\" + formerImageHeight) + (\" to \" + imageWidth + \"X\" + imageHeight + \".\"));\n      return this.computeCanvasDrawConfig(imageWidth, imageHeight, containerWidth, containerHeight);\n    }\n  };\n\n  Html5Qrcode.prototype.clearElement = function () {\n    if (this.stateManagerProxy.isScanning()) {\n      throw \"Cannot clear while scan is ongoing, close it first.\";\n    }\n\n    var element = document.getElementById(this.elementId);\n\n    if (element) {\n      element.innerHTML = \"\";\n    }\n  };\n\n  Html5Qrcode.prototype.createVideoElement = function (width) {\n    var videoElement = document.createElement(\"video\");\n    videoElement.style.width = width + \"px\";\n    videoElement.muted = true;\n    videoElement.setAttribute(\"muted\", \"true\");\n    videoElement.playsInline = true;\n    return videoElement;\n  };\n\n  Html5Qrcode.prototype.possiblyUpdateShaders = function (qrMatch) {\n    if (this.qrMatch === qrMatch) {\n      return;\n    }\n\n    if (this.hasBorderShaders && this.borderShaders && this.borderShaders.length) {\n      this.borderShaders.forEach(function (shader) {\n        shader.style.backgroundColor = qrMatch ? Constants.BORDER_SHADER_MATCH_COLOR : Constants.BORDER_SHADER_DEFAULT_COLOR;\n      });\n    }\n\n    this.qrMatch = qrMatch;\n  };\n\n  Html5Qrcode.prototype.possiblyCloseLastScanImageFile = function () {\n    if (this.lastScanImageFile) {\n      URL.revokeObjectURL(this.lastScanImageFile);\n      this.lastScanImageFile = null;\n    }\n  };\n\n  Html5Qrcode.prototype.createCanvasElement = function (width, height, customId) {\n    var canvasWidth = width;\n    var canvasHeight = height;\n    var canvasElement = document.createElement(\"canvas\");\n    canvasElement.style.width = canvasWidth + \"px\";\n    canvasElement.style.height = canvasHeight + \"px\";\n    canvasElement.style.display = \"none\";\n    canvasElement.id = isNullOrUndefined(customId) ? \"qr-canvas\" : customId;\n    return canvasElement;\n  };\n\n  Html5Qrcode.prototype.getShadedRegionBounds = function (width, height, qrboxSize) {\n    if (qrboxSize.width > width || qrboxSize.height > height) {\n      throw \"'config.qrbox' dimensions should not be greater than the \" + \"dimensions of the root HTML element.\";\n    }\n\n    return {\n      x: (width - qrboxSize.width) / 2,\n      y: (height - qrboxSize.height) / 2,\n      width: qrboxSize.width,\n      height: qrboxSize.height\n    };\n  };\n\n  Html5Qrcode.prototype.possiblyInsertShadingElement = function (element, width, height, qrboxSize) {\n    if (width - qrboxSize.width < 1 || height - qrboxSize.height < 1) {\n      return;\n    }\n\n    var shadingElement = document.createElement(\"div\");\n    shadingElement.style.position = \"absolute\";\n    var rightLeftBorderSize = (width - qrboxSize.width) / 2;\n    var topBottomBorderSize = (height - qrboxSize.height) / 2;\n    shadingElement.style.borderLeft = rightLeftBorderSize + \"px solid #0000007a\";\n    shadingElement.style.borderRight = rightLeftBorderSize + \"px solid #0000007a\";\n    shadingElement.style.borderTop = topBottomBorderSize + \"px solid #0000007a\";\n    shadingElement.style.borderBottom = topBottomBorderSize + \"px solid #0000007a\";\n    shadingElement.style.boxSizing = \"border-box\";\n    shadingElement.style.top = \"0px\";\n    shadingElement.style.bottom = \"0px\";\n    shadingElement.style.left = \"0px\";\n    shadingElement.style.right = \"0px\";\n    shadingElement.id = \"\" + Constants.SHADED_REGION_ELEMENT_ID;\n\n    if (width - qrboxSize.width < 11 || height - qrboxSize.height < 11) {\n      this.hasBorderShaders = false;\n    } else {\n      var smallSize = 5;\n      var largeSize = 40;\n      this.insertShaderBorders(shadingElement, largeSize, smallSize, -smallSize, 0, true);\n      this.insertShaderBorders(shadingElement, largeSize, smallSize, -smallSize, 0, false);\n      this.insertShaderBorders(shadingElement, largeSize, smallSize, qrboxSize.height + smallSize, 0, true);\n      this.insertShaderBorders(shadingElement, largeSize, smallSize, qrboxSize.height + smallSize, 0, false);\n      this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, -smallSize, -smallSize, true);\n      this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, qrboxSize.height + smallSize - largeSize, -smallSize, true);\n      this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, -smallSize, -smallSize, false);\n      this.insertShaderBorders(shadingElement, smallSize, largeSize + smallSize, qrboxSize.height + smallSize - largeSize, -smallSize, false);\n      this.hasBorderShaders = true;\n    }\n\n    element.append(shadingElement);\n  };\n\n  Html5Qrcode.prototype.insertShaderBorders = function (shaderElem, width, height, top, side, isLeft) {\n    var elem = document.createElement(\"div\");\n    elem.style.position = \"absolute\";\n    elem.style.backgroundColor = Constants.BORDER_SHADER_DEFAULT_COLOR;\n    elem.style.width = width + \"px\";\n    elem.style.height = height + \"px\";\n    elem.style.top = top + \"px\";\n\n    if (isLeft) {\n      elem.style.left = side + \"px\";\n    } else {\n      elem.style.right = side + \"px\";\n    }\n\n    if (!this.borderShaders) {\n      this.borderShaders = [];\n    }\n\n    this.borderShaders.push(elem);\n    shaderElem.appendChild(elem);\n  };\n\n  Html5Qrcode.prototype.showPausedState = function () {\n    if (!this.scannerPausedUiElement) {\n      throw \"[internal error] scanner paused UI element not found\";\n    }\n\n    this.scannerPausedUiElement.style.display = \"block\";\n  };\n\n  Html5Qrcode.prototype.hidePausedState = function () {\n    if (!this.scannerPausedUiElement) {\n      throw \"[internal error] scanner paused UI element not found\";\n    }\n\n    this.scannerPausedUiElement.style.display = \"none\";\n  };\n\n  Html5Qrcode.prototype.getTimeoutFps = function (fps) {\n    return 1000 / fps;\n  };\n\n  return Html5Qrcode;\n}();\n\nexport { Html5Qrcode };","map":{"version":3,"mappings":"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","names":["BaseLoggger","Html5QrcodeResultFactory","Html5QrcodeErrorFactory","Html5QrcodeSupportedFormats","isValidHtml5QrcodeSupportedFormats","Html5QrcodeConstants","isNullOrUndefined","Html5QrcodeStrings","VideoConstraintsUtil","Html5QrcodeShim","ExperimentalFeaturesConfigFactory","StateManagerFactory","Html5QrcodeScannerState","__extends","Constants","config","logger","fps","SCAN_DEFAULT_FPS","disableFlip","DEFAULT_DISABLE_FLIP","qrbox","aspectRatio","videoConstraints","InternalHtml5QrcodeConfig","logError","isMediaStreamConstraintsValid","elementId","configOrVerbosityFlag","document","getElementById","verbose","experimentalFeatureConfig","experimentalFeatures","qrcode","getSupportedFormats","createExperimentalFeaturesConfig","foreverScanTimeout","localMediaStream","shouldScan","stateManagerProxy","create","Html5Qrcode","cameraIdOrConfig","configuration","qrCodeSuccessCallback","qrCodeErrorCallback","log","internalConfig","clearElement","videoConstraintsAvailableAndValid","areVideoConstraintsEnabled","isShadedBoxEnabled","element","rootElementWidth","clientWidth","DEFAULT_WIDTH","style","position","$this","toScanningStateChangeTransaction","startTransition","SCANNING","Promise","resolve","reject","createVideoConstraints","cancel","navigator","mediaDevices","getUserMedia","audio","video","then","stream","onMediaStreamReceived","_","execute","isScanning","catch","error","errorGettingUserMedia","cameraStreamingNotSupported","shouldPauseVideo","isStrictlyScanning","directTransition","PAUSED","showPausedState","videoElement","pause","isPaused","transitionToScanning","hidePausedState","isVideoPaused","paused","onVideoResume","setTimeout","_a","removeEventListener","addEventListener","play","getState","toStoppedStateTransaction","NOT_STARTED","clearTimeout","removeQrRegion","_this","childElement","SHADED_REGION_ELEMENT_ID","removeChild","onAllTracksClosed","canvasElement","qrRegion","context","tracksToClose","getVideoTracks","length","tracksClosed","forEach","videoTrack","removeTrack","stop","imageFile","showImage","scanFileV2","html5qrcodeResult","decodedText","File","canScanFile","possiblyCloseLastScanImageFile","lastScanImageFile","URL","createObjectURL","inputImage","Image","onload","imageWidth","width","imageHeight","height","containerWidth","containerHeight","Math","max","clientHeight","FILE_SCAN_MIN_HEIGHT","computeCanvasDrawConfig","visibleCanvas","createCanvasElement","display","appendChild","context_1","getContext","canvas","drawImage","x","y","hiddenCanvas","decodeAsync","result","createFromQrcodeResult","exception","onerror","onabort","onstalled","onsuspend","src","getCamerasFromMediaDevices","mst","MediaStreamTrack","getSources","getCamerasFromMediaStreamTrack","isHttpsOrLocalhost","location","protocol","host","split","errorMessage","unableToQuerySupportedDevices","insecureContextCameraQueryError","getCapabilities","videoConstaints","applyConstraints","closeActiveStreams","tracks","_i","track","enabled","enumerateDevices","devices","results","device","kind","push","id","deviceId","label","err","name","message","callback","sourceInfos","sourceInfo","allFormats","QR_CODE","AZTEC","CODABAR","CODE_39","CODE_93","CODE_128","DATA_MATRIX","MAXICODE","ITF","EAN_13","EAN_8","PDF_417","RSS_14","RSS_EXPANDED","UPC_A","UPC_E","UPC_EAN_EXTENSION","formatsToSupport","Array","isArray","supportedFormats","format","warn","viewfinderWidth","viewfinderHeight","qrboxSize","validateQrboxConfig","qrDimensions","toQrdimensions","validateMinSize","size","MIN_QR_BOX_SIZE","correctWidthBasedOnRootElementSize","configWidth","undefined","Error","validateQrboxSize","shouldShadingBeApplied","defaultQrRegion","getShadedRegionBounds","append","possiblyInsertShadingElement","createScannerPausedUiElement","rootElement","scannerPausedUiElement","createElement","innerText","top","zIndex","background","textAlign","text","possiblyUpdateShaders","codeParseError","createFrom","widthRatio","videoWidth","heightRatio","videoHeight","sWidthOffset","sHeightOffset","sxOffset","syOffset","triggerNextScan","foreverScan","getTimeoutFps","scanContext","isSuccessfull","translate","scale","finally","mediaStream","setupVideo","createVideoElement","onVideoStart","setupUi","srcObject","constraints","logErrors","exact","facingModeKey","deviceIdKey","allowedFacingModeValues_1","exactKey","isValidFacingModeValue","value","keys","Object","key","facingMode","type_1","type_2","type","xoffset","yoffset","formerImageWidth","formerImageHeight","innerHTML","muted","setAttribute","playsInline","qrMatch","hasBorderShaders","borderShaders","shader","backgroundColor","BORDER_SHADER_MATCH_COLOR","BORDER_SHADER_DEFAULT_COLOR","revokeObjectURL","customId","canvasWidth","canvasHeight","shadingElement","rightLeftBorderSize","topBottomBorderSize","borderLeft","borderRight","borderTop","borderBottom","boxSizing","bottom","left","right","smallSize","largeSize","insertShaderBorders","shaderElem","side","isLeft","elem"],"sources":["../../src/html5-qrcode.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}